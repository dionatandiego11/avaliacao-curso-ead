<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Avaliar Curso EAD</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- USER_RA_PLACEHOLDER -->
  <style>
    input[type="range"]::-webkit-slider-thumb {
      background-color: #dc2626;
    }
    input[type="range"]::-moz-range-thumb {
      background-color: #dc2626;
    }
    input[type="range"]::-ms-thumb {
      background-color: #dc2626;
    }
  </style>
</head>
<body class="bg-gray-50 font-sans">

  <header class="bg-red-600 text-white">
    <div class="max-w-7xl mx-auto flex justify-between items-center px-6 py-4">
      <div class="text-xl font-bold">REAVALIE<span class="text-yellow-300">EAD</span></div>
      <nav class="space-x-6 hidden md:block">
        <a href="/" class="hover:underline">Início</a>
        <a href="/artigos" class="hover:underline">Artigos</a>
        <a href="/entrar" class="hover:underline">Entrar</a>
        <a href="/para-instituicoes" class="bg-white text-red-600 px-4 py-2 rounded hover:bg-gray-100 font-semibold">Para Instituições</a>
      </nav>
    </div>
  </header>

  <main class="max-w-4xl mx-auto px-6 py-10 bg-white shadow mt-8 rounded-lg">
    <h1 class="text-3xl font-bold text-red-600 mb-6 text-center">Avalie seu Curso EAD</h1>

    <form method="POST" action="/api/avaliar" class="space-y-6">

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label class="block text-sm font-medium text-gray-700">R.A. (Registro Acadêmico)</label>
          <input name="ra" id="ra" type="text" class="mt-1 block w-full border border-gray-300 rounded-md px-4 py-2" placeholder="Ex: 1234567 (Opcional se logado)" />
        </div>
        <div>
          <label for="tipoInstituicao" class="block text-sm font-medium text-gray-700">Tipo de Instituição</label>
          <select id="tipoInstituicao" name="tipo_instituicao" required class="mt-1 block w-full border border-gray-300 rounded-md px-4 py-2">
            <option value="">Selecione o Tipo</option>
            <option value="publica">Pública</option>
            <option value="privada">Privada</option>
          </select>
        </div>
        <div>
          <label for="instituicao" class="block text-sm font-medium text-gray-700">Instituição de Ensino</label>
          <select id="instituicao" name="instituicao_id" required class="mt-1 block w-full border border-gray-300 rounded-md px-4 py-2" disabled>
            <option value="">Selecione primeiro o tipo</option>
          </select>
        </div>
        <div>
          <label for="curso" class="block text-sm font-medium text-gray-700">Nome do Curso</label>
          <select id="curso" name="curso_id" required class="mt-1 block w-full border border-gray-300 rounded-md px-4 py-2" disabled>
            <option value="">Selecione primeiro a instituição</option>
          </select>
        </div>
        <div id="poloCidadeContainer" class="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6" style="display: none;">
            <div>
                <label for="polo" class="block text-sm font-medium text-gray-700">Polo</label>
                <input type="text" name="polo" id="polo" class="mt-1 block w-full border border-gray-300 rounded-md px-4 py-2" placeholder="Nome do Polo/Campus">
            </div>
            <div>
                <label for="cidade" class="block text-sm font-medium text-gray-700">Cidade do Polo</label>
                <input type="text" name="cidade" id="cidade" class="mt-1 block w-full border border-gray-300 rounded-md px-4 py-2" placeholder="Cidade onde o polo está localizado">
            </div>
        </div>
      </div>

      <div class="mt-8">
        <h2 class="text-lg font-semibold text-gray-800 mb-2">Avaliação por critérios</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label class="block text-sm">Qualidade do conteúdo</label><input name="conteudo" type="range" min="1" max="5" class="w-full accent-red-600" value="3" /></div>
          <div><label class="block text-sm">Competência dos professores</label><input name="professores" type="range" min="1" max="5" class="w-full accent-red-600" value="3" /></div>
          <div><label class="block text-sm">Apoio ao estudante</label><input name="apoio" type="range" min="1" max="5" class="w-full accent-red-600" value="3" /></div>
          <div><label class="block text-sm">Estrutura e funcionamento do polo</label><input name="estrutura" type="range" min="1" max="5" class="w-full accent-red-600" value="3" /></div>
          <div><label class="block text-sm">Material didático</label><input name="material" type="range" min="1" max="5" class="w-full accent-red-600" value="3" /></div>
          <div><label class="block text-sm">Experiência com o app e aulas</label><input name="experiencia" type="range" min="1" max="5" class="w-full accent-red-600" value="3" /></div>
        </div>
      </div>

      <div class="mt-6">
        <label class="block text-sm font-medium text-gray-700 mb-1">Você recomenda esse curso?</label>
        <div class="flex items-center space-x-6">
          <label><input type="radio" name="recomenda" value="Sim" required class="mr-2" /> Sim</label>
          <label><input type="radio"name="recomenda" value="Não" required class="mr-2" /> Não</label>
        </div>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">Comentário adicional (opcional)</label>
        <textarea name="comentario" rows="4" class="mt-1 block w-full border border-gray-300 rounded-md px-4 py-2" placeholder="Deixe seu comentário sobre o curso..."></textarea>
      </div>

      <div class="text-center">
        <button type="submit" class="bg-red-600 hover:bg-red-700 text-white font-semibold px-6 py-3 rounded-md shadow">
          Enviar Avaliação
        </button>
      </div>
    </form>
  </main>

  <footer class="text-center text-sm text-gray-500 mt-12 py-6">
    © 2025 ReavalieEAD. Todos os direitos reservados.
  </footer>

  <script>
    const tipoInstituicaoSelect = document.getElementById('tipoInstituicao');
    const instituicaoSelect = document.getElementById('instituicao');
    const cursoSelect = document.getElementById('curso');
    const poloCidadeContainer = document.getElementById('poloCidadeContainer');
    const poloInput = document.getElementById('polo');
    const cidadeInput = document.getElementById('cidade');

    async function fetchAndPopulate(selectElement, url, defaultOptionText) {
        selectElement.innerHTML = `<option value="">Carregando...</option>`;
        selectElement.disabled = true;
        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json();

            selectElement.innerHTML = `<option value="">${defaultOptionText}</option>`;
            data.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = item.nome;
                selectElement.appendChild(option);
            });
            selectElement.disabled = false;
        } catch (error) {
            console.error("Erro ao buscar dados:", error);
            selectElement.innerHTML = `<option value="">Erro ao carregar</option>`;
            selectElement.disabled = true;
        }
    }

    tipoInstituicaoSelect.addEventListener('change', () => {
        const tipo = tipoInstituicaoSelect.value;
        cursoSelect.innerHTML = '<option value="">Selecione primeiro a instituição</option>';
        cursoSelect.disabled = true;
        poloCidadeContainer.style.display = 'none';
        if (tipo) {
            fetchAndPopulate(instituicaoSelect, `/api/instituicoes/${tipo}`, 'Selecione a Instituição');
        } else {
            instituicaoSelect.innerHTML = '<option value="">Selecione primeiro o tipo</option>';
            instituicaoSelect.disabled = true;
        }
    });

    instituicaoSelect.addEventListener('change', () => {
        const instituicaoId = instituicaoSelect.value;
        poloCidadeContainer.style.display = 'none';
        if (instituicaoId) {
            fetchAndPopulate(cursoSelect, `/api/cursos/instituicao/${instituicaoId}`, 'Selecione o Curso');
        } else {
            cursoSelect.innerHTML = '<option value="">Selecione primeiro a instituição</option>';
            cursoSelect.disabled = true;
        }
    });

    cursoSelect.addEventListener('change', () => {
        if (cursoSelect.value) {
            poloCidadeContainer.style.display = 'grid'; // Or 'flex' or 'block' depending on desired layout
        } else {
            poloCidadeContainer.style.display = 'none';
        }
    });

    // Pre-fill RA if available (part of step 8, but good to have the element ID ready)
    const raInput = document.getElementById('ra');
    if (typeof loggedInUserRA !== 'undefined' && loggedInUserRA) {
        raInput.value = loggedInUserRA;
        raInput.readOnly = true; // Optional: make it read-only if pre-filled
        raInput.classList.add('bg-gray-200'); // Optional: visual indication
    }

  </script>
</body>
</html>
